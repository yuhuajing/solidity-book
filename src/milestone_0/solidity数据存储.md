# æ•°æ®å­˜å‚¨
## åˆçº¦å­˜å‚¨
åœ¨ä»¥å¤ªåŠä¸­ï¼š

æ™ºèƒ½åˆçº¦çš„ å­—èŠ‚ç ï¼ˆ`bytecode`ï¼‰

æ™ºèƒ½åˆçº¦çš„ çŠ¶æ€å˜é‡ï¼ˆ`storage` å˜é‡ï¼‰

æ˜¯å­˜å‚¨åœ¨ä¸¤ç§å®Œå…¨ä¸åŒçš„åœ°æ–¹ï¼Œå®ƒä»¬æ˜¯ç‰©ç†åˆ†ç¦»çš„ã€‚

### ğŸ” ä»€ä¹ˆæ˜¯ bytecodeï¼Ÿ
å½“ä½ éƒ¨ç½²ä¸€ä¸ªæ™ºèƒ½åˆçº¦æ—¶ï¼Œ`Solidity` æºç ä¼šè¢«ç¼–è¯‘æˆ `EVM bytecode`ï¼Œæ¯”å¦‚ï¼š
```solidity
function get() public view returns (uint256) {
    return storedData;
}
```
è¿™æ®µä»£ç çš„é€»è¾‘ä¼šè¢«ç¼–è¯‘ä¸ºä¸€ç»„å­—èŠ‚ç ï¼ˆåå…­è¿›åˆ¶çš„æœºå™¨æŒ‡ä»¤ï¼‰ï¼Œéƒ¨ç½²åœ¨é“¾ä¸Šï¼Œå¹¶ä¸”æ˜¯ä¸å¯å˜çš„ã€‚

â¡ï¸ å­˜æ”¾ä½ç½®ï¼šè¯¥åˆçº¦åœ°å€çš„ä»£ç åŒºï¼ˆ`code area`ï¼‰

### ğŸ” ä»€ä¹ˆæ˜¯ storage å˜é‡ï¼Ÿ
```solidity
uint256 public storedData = 42;
```
è¿™ä¸ª `storedData` æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒçš„å€¼æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ï¼ˆå¯å†™å…¥çš„ï¼‰ã€‚

`Solidity` ä¼šå°†å®ƒå­˜å‚¨åœ¨åˆçº¦åœ°å€å…³è”çš„çŠ¶æ€å­˜å‚¨ç©ºé—´ä¸­ï¼ˆ`Storage Trie`ï¼‰ã€‚

â¡ï¸ å­˜æ”¾ä½ç½®ï¼š`State Trie` ä¸­ï¼Œä»¥åˆçº¦åœ°å€ä¸º `key`ï¼Œ`slot` ä¸ºå­ `key`

### âœ… ä¸¤è€…çš„ä¸»è¦åŒºåˆ«ï¼š
```csharp
[Blockchain Storage]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆçº¦åœ°å€ 0xABC...123       â”‚
â”‚                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚ Bytecode åŒºåŸŸâ”‚  â†  ä»£ç ï¼ˆä¸å¯å˜ï¼‰       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚ Storage Trie â”‚  â† å˜é‡ï¼ˆå¯å˜ï¼‰         â”‚
â”‚   â”‚  slot 0: 123 â”‚                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```
| ç±»åˆ«             | å­˜å‚¨ä½ç½®             | æ˜¯å¦å¯ä¿®æ”¹  | è®¿é—®æ–¹å¼                           |
| -------------- | ---------------- | ------ | ------------------------------ |
| **Bytecode**   | åˆçº¦åœ°å€çš„ä»£ç åŒº         | âŒ ä¸å¯ä¿®æ”¹ | `EXTCODECOPY`, `EXTCODESIZE` ç­‰ |
| **Storage å˜é‡** | çŠ¶æ€å­˜å‚¨ï¼ˆState Trieï¼‰ | âœ… å¯ä¿®æ”¹  | `SLOAD`, `SSTORE`              |

## å˜é‡ä½œç”¨åŸŸ
- çŠ¶æ€å˜é‡
  - å®šä¹‰åœ¨åˆçº¦ä¸­ï¼Œä½†æ˜¯åœ¨å‡½æ•°å¤–çš„éœ€è¦å­˜å‚¨åœ¨åˆçº¦ `slot` çš„å˜é‡
- å±€éƒ¨å˜é‡
  - å®šä¹‰åœ¨åˆçº¦å‡½æ•°å†…éƒ¨ï¼Œä»…åœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆçš„æ•°æ®ï¼Œå˜é‡ç”Ÿå‘½å‘¨æœŸå’Œå‡½æ•°æ‰§è¡Œå‘¨æœŸä¸€è‡´
- [å…¨å±€å˜é‡](https://www.evm.codes/?fork=cancun#40)ã€‚
  - é“¾ä¸Šæ•°æ®ï¼Œå…¨å±€å˜é‡ç¼–ç åˆ° `EVM` å­—èŠ‚ç ä¸­
```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;

contract Variables {
    // State variables are stored on the blockchain.
    string public hello = "Hello";
    uint256 public num = 123;

    function interVariables() public view returns (uint256 ts) {
        // Local variables are not saved to the blockchain.
        uint256 i = 456;
        // Here are some global variables
        ts = block.timestamp; // 147 gas cost
        // assembly {
        //     ts := timestamp() // 213 gas cost
        // }
        {
            // å¯ä»¥ä½¿ç”¨åˆçº¦çŠ¶æ€å˜é‡/æœ¬å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡/åŒºå—é“¾ä¸Šå…¨å±€å˜é‡
            uint interTs = 356;
            interTs += block.timestamp;
            interTs += i;
            interTs += num;
        }
       // interTs +=9; å¤–éƒ¨æ— æ³•è®¿é—®ä½œç”¨åŸŸå†…éƒ¨çš„å‚æ•°
    }
}
```
![](./images/global_variables.png)
